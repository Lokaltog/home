# vim:set ft=sh:
pkgname="dwm-hg"
pkgver=1528
pkgrel=1
pkgdesc="The latest hg pull of dwm"
url="http://dwm.suckless.org"
license="MIT"
arch=("any")
depends=("libx11")
makedepends=("mercurial" "sed")
conflicts=("dwm")
provides=("dwm")

_patches=(dwm-base.diff
          dwm-attachaside.diff
          dwm-tune.diff
          dwm-gaplessgrid.diff
          dwm-pertag.diff
          dwm-statuscolors.diff
          dwm-colors.diff
          dwm-monoclecount.diff
          dwm-bstack.diff)
source=(config.h
        ${_patches[@]})

_hgroot="http://code.suckless.org/hg"
_hgrepo="dwm"

build() {
	cd ${startdir}/src

	if [ -d ${_hgrepo} ]; then
		cd ${_hgrepo}
		make clean
		hg pull -u
	else
		hg clone ${_hgroot}/${_hgrepo}
		cd ${_hgrepo}
	fi

	cp $srcdir/config.h .

	msg "Applying patches..."
	for patch in ${_patches[@]}; do
		hg patch -m null -u null ${srcdir}/${patch} || return 1
	done

	msg "Starting build process..."
	make || return 1
	make PREFIX=${startdir}/pkg/usr install

	mkdir -p ${startdir}/pkg/usr/share/licenses/dwm
	cp LICENSE ${startdir}/pkg/usr/share/licenses/dwm
}
